rm(list=ls())
setwd("/Users/udayshankar/Desktop/UPElectionsRfiles")
getwd()

#Activating required packages
library("twitteR")
library("devtools")
library("qdap")
library("tm")
library("shiny")
library("syuzhet")
library("taskscheduleR")
library("sentR")
library("RSentiment")
library("ROAuth")
library("stringr")
library("wordcloud")
library("RCurl")
library("RJSONIO")
library("httr")
library("plyr")
library("dplyr")
library("RTextTools", lib.loc="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library("ggplot2", lib.loc="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library("lubridate", lib.loc="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library("e1071", lib.loc="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
install.packages("tidytext")
library("tidytext")
library("RCurl")
options(RCurlOptions = list(cainfo = system.file("CurlSSL", "cacert.pem", package = "RCurl")))

#Setting up Twitter credentials and authorizing the app with OAuth protocols
api_key <- "kEMBMyT56PGPom9ouH2to4bR7"
api_secret <- "iSQsvdGwpO3sMSQNmSe7IfVshJnAoF2J1fcH8c7wA3UVyOd4Nx"
access_token <- "1118258383-zti8cbk0tt93lItM98s5u7geLdKRmEspeB4RvIL"
access_token_secret <- "pH6ZtwXNNR59sSM6Q5PEcsQfYcKqjBxM41ZoHSBw3y8nz"
setup_twitter_oauth(api_key,api_secret,access_token,access_token_secret)

tweets_namo_upelec <- searchTwitter("@narendramodi",n=2000)
tweets_namo_upelec_df <- twListToDF(tweets_namo_upelec)
View(tweets_namo_upelec_df)
tweets_namo_nohandles <- str_replace_all(tweets_namo_upelec_df$text,"@\\w+","")
tweets_namo_corpus <- tm_map(tweets_namo_corpus,removePunctuation)
tweets_namo_corpus <- tm_map(tweets_namo_corpus,content_transformer(tolower))
tweets_namo_corpus <- tm_map(tweets_namo_corpus,removeWords,stopwords("english"))
tweets_namo_corpus <- tm_map(tweets_namo_corpus,stripWhitespace)
tweets_namo_corpus <- tm_map(tweets_namo_corpus,stemDocument)
tweets_namo_nohandles <- str_replace_all(tweets_namo_upelec_df$text,"@\\w+","")
tweets_namo_corpus <- Corpus(VectorSource(tweets_namo_nohandles))
tweets_namo_corpus <- tm_map(tweets_namo_corpus,removePunctuation)
tweets_namo_corpus <- tm_map(tweets_namo_corpus,content_transformer(tolower))
tweets_namo_corpus <- tm_map(tweets_namo_corpus,removeWords,stopwords("english"))
tweets_namo_corpus <- tm_map(tweets_namo_corpus,stripWhitespace)
pal <- brewer.pal(9,"YlGnBu")
set.seed(123)
wordcloud(words = tweets_namo_corpus,scale=c(5,0.1),max.words = 100,random.order = FALSE,rot.per = 0.25,use.r.layout = FALSE,colors = pal)
warnings()
tweets_namo_hastags <- regmatches(tweets_namo_corpus,gregexpr("#(\\d|\\w)+",tweets_namo_corpus))
tweets_namo_hastags <- regmatches(tweets_namo_upelec,gregexpr("#(\\d|\\w)+",tweets_namo_upelec))
tweets_namo_hastags <- regmatches(tweets_namo_nohandles,gregexpr("#(\\d|\\w)+",tweets_namo_nohandles))
tweets_namo_hastags
View(tweets_namo_hastags)
tweets_namo_upelec_df_clean <- gsub("&amp", "", tweets_namo_upelec_df)
tweets_namo_upelec_df_clean <- gsub("(RT|via)((?:\\b\\W*@\\w+)+)", "", tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean = gsub("@\\w+", "", tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean = gsub("[[:punct:]]","",tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean = gsub("[[:digit:]]", "", tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean = gsub("http\\w+", "", tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean = gsub("[ \t]{2,}", "", tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean = gsub("^\\s+|\\s+$", "", tweets_namo_upelec_df_clean)
tweets_namo_upelec_df_clean <- str_replace_all(tweets_namo_upelec_df_clean," "," ")
tweets_namo_upelec_df_clean <- str_replace_all(tweets_namo_upelec_df_clean, "http://t.co/[a-z,A-Z,0-9]*{8}","")
tweets_namo_upelec_df_clean <- str_replace_all(tweets_namo_upelec_df_clean,"http://t.co/[a-z,A-Z,0-9]*{8}","")
tweets_namo_upelec_df_clean <- str_replace_all(tweets_namo_upelec_df_clean,"#[a-z,A-Z]*","")
tweets_namo_upelec_df_clean <- str_replace_all(tweets_namo_upelec_df_clean,"@[a-z,A-Z]*","")
wordcloud(words = tweets_namo_upelec_df_clean,scale=c(5,0.1),max.words = 100,random.order = FALSE,rot.per = 0.25,use.r.layout = FALSE,colors = pal)
tweets_upelections <- searchTwitter("#uppolls2017",since = "10-02-2017",until = "12-02-2017",n=2000)

#Without removing the hashtags
upelections <- read.table(file.choose(),header = TRUE,stringsAsFactors = FALSE)
upelections_nohandles <- str_replace_all(upelections$text,"@\\w+","")
upelections_corpus <- Corpus(VectorSource(upelections_nohandles))
upelections_tdm <- TermDocumentMatrix(upelections_corpus,control = list(removePunctuation=TRUE,stopwords=c("upelections","upelections2017","uppolls2017",stopwords("english")),removeNumbers=TRUE,tolower=TRUE))
upelections_matrix <- as.matrix(upelections_tdm)
upelections_wordfreq <- sort(rowSums(upelections_matrix),decreasing = TRUE)
upelections_df <- data.frame(word=names(upelections_wordfreq),freq=upelections_wordfreq)
wordcloud(upelections_df$word,upelections_df$freq,random.order = FALSE,colors = pal)
upelections_sentiment <- get_nrc_sentiment(upelections_nohandles)
upelections_sentiment
upelections_1 <- cbind(upelections,upelections_sentiment)
upelections_1_sentitools <- data.frame(colSums(upelections_1[,c(17:26)]))
names(upelections_1_sentitools) <- "count"
upelections_1_sentitools <- cbind("sentiment"=rownames(upelections_1_sentitools),upelections_1_sentitools)
rownames(upelections_1_sentitools) <- NULL
ggplot(data = upelections_1_sentitools,aes(x=sentiment,y=count))+geom_bar(aes(fill=sentiment),stat = "identity")+theme(legend.position = "none")+xlab("sentiment")+ylab("totalcount")+ggtitle("Total Sentiment Score")

#By removing the Retweets(RT's)
tweets_upelections_norts <- read.table(file.choose(),header = TRUE,stringsAsFactors = FALSE)
tweets_upelections_norts_nohandles <- str_replace_all(tweets_upelections_norts$text,"@\\w+","")
tweets_upelections_norts_nohandles <- gsub("(RT|via)((?:\\b\\W*@\\w+)+)", "", tweets_upelections_norts_nohandles)
tweets_upelections_norts_corpus <- Corpus(VectorSource(tweets_upelections_norts_nohandles))
tweets_upelections_norts_tdm <- TermDocumentMatrix(tweets_upelections_norts_corpus,control = list(removePunctuation=TRUE,stopwords=c("upelections","upelections2017","uppolls2017",stopwords("english")),removeNumbers=TRUE,tolower=TRUE))
tweets_upelections_norts_matrix <- as.matrix(tweets_upelections_norts_tdm)
tweets_upelections_norts_wordfreq <- sort(rowSums(tweets_upelections_norts_matrix),decreasing = TRUE)
tweets_upelections_norts_df <- data.frame(word=names(tweets_upelections_norts_wordfreq),freq=tweets_upelections_norts_wordfreq)
wordcloud(tweets_upelections_norts_df$word,tweets_upelections_norts_df$freq,random.order = FALSE,colors = pal)
tweets_upelections_norts_sentiment <- get_nrc_sentiment(tweets_upelections_norts_nohandles)
tweets_upelections_norts_sentiment
tweets_upelections_norts_1 <- cbind(tweets_upelections_norts,tweets_upelections_norts_sentiment)
View(tweets_upelections_norts_1)
tweets_upelections_norts_sentimenttotal <- data.frame(colSums(tweets_upelections_norts_1[,c(17:26)]))
names(tweets_upelections_norts_sentimenttotal) <- "count"
tweets_upelections_norts_sentimenttotal <- cbind("sentiment"=rownames(tweets_upelections_norts_sentimenttotal),tweets_upelections_norts_sentimenttotal)
rownames(tweets_upelections_norts_sentimenttotal) <- NULL
ggplot(data = tweets_upelections_norts_sentimenttotal,aes(x=sentiment,y=count))+geom_bar(aes(fill=sentiment),stat = "identity")+theme(legend.position = "none")+xlab("sentiment")+ylab("totalcount")+ggtitle("Total Sentiment Score")

